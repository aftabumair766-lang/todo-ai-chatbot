{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "MCP Tools Contract",
  "description": "Model Context Protocol (MCP) tools for Todo AI Chatbot task management. All tools are stateless and validate user ownership.",
  "version": "1.0.0",
  "tools": [
    {
      "name": "add_task",
      "description": "Create a new todo task for the authenticated user",
      "inputSchema": {
        "type": "object",
        "properties": {
          "user_id": {
            "type": "string",
            "description": "Authenticated user ID from Better Auth (validated against JWT token)",
            "pattern": "^auth0\\|[a-zA-Z0-9]{24}$",
            "example": "auth0|507f1f77bcf86cd799439011"
          },
          "title": {
            "type": "string",
            "description": "Task title (2-10 words typical, max 500 chars)",
            "minLength": 1,
            "maxLength": 500,
            "example": "Buy groceries"
          },
          "description": {
            "type": ["string", "null"],
            "description": "Optional task description (max 2000 chars)",
            "maxLength": 2000,
            "example": "Milk, eggs, bread from Whole Foods"
          }
        },
        "required": ["user_id", "title"],
        "additionalProperties": false
      },
      "outputSchema": {
        "type": "object",
        "properties": {
          "task_id": {
            "type": "integer",
            "description": "Unique ID of the created task",
            "example": 42
          },
          "status": {
            "type": "string",
            "enum": ["created"],
            "example": "created"
          },
          "title": {
            "type": "string",
            "description": "Title of the created task (echoed back)",
            "example": "Buy groceries"
          }
        },
        "required": ["task_id", "status", "title"]
      },
      "errors": [
        {
          "code": "VALIDATION_ERROR",
          "message": "Title cannot be empty or exceed 500 characters"
        },
        {
          "code": "UNAUTHORIZED",
          "message": "user_id does not match authenticated user"
        },
        {
          "code": "DATABASE_ERROR",
          "message": "Failed to create task in database"
        }
      ]
    },
    {
      "name": "list_tasks",
      "description": "Retrieve tasks for the authenticated user with optional filtering by completion status",
      "inputSchema": {
        "type": "object",
        "properties": {
          "user_id": {
            "type": "string",
            "description": "Authenticated user ID from Better Auth",
            "pattern": "^auth0\\|[a-zA-Z0-9]{24}$",
            "example": "auth0|507f1f77bcf86cd799439011"
          },
          "status": {
            "type": "string",
            "enum": ["all", "pending", "completed"],
            "default": "all",
            "description": "Filter tasks by completion status",
            "example": "pending"
          }
        },
        "required": ["user_id"],
        "additionalProperties": false
      },
      "outputSchema": {
        "type": "array",
        "description": "Array of tasks matching the filter criteria",
        "items": {
          "type": "object",
          "properties": {
            "id": {
              "type": "integer",
              "example": 1
            },
            "title": {
              "type": "string",
              "example": "Buy groceries"
            },
            "description": {
              "type": ["string", "null"],
              "example": "Milk, eggs, bread"
            },
            "completed": {
              "type": "boolean",
              "example": false
            },
            "created_at": {
              "type": "string",
              "format": "date-time",
              "example": "2025-12-14T10:30:00Z"
            },
            "updated_at": {
              "type": "string",
              "format": "date-time",
              "example": "2025-12-14T10:30:00Z"
            }
          },
          "required": ["id", "title", "completed", "created_at", "updated_at"]
        }
      },
      "errors": [
        {
          "code": "VALIDATION_ERROR",
          "message": "Invalid status filter (must be 'all', 'pending', or 'completed')"
        },
        {
          "code": "UNAUTHORIZED",
          "message": "user_id does not match authenticated user"
        },
        {
          "code": "DATABASE_ERROR",
          "message": "Failed to retrieve tasks from database"
        }
      ]
    },
    {
      "name": "complete_task",
      "description": "Mark a task as completed for the authenticated user",
      "inputSchema": {
        "type": "object",
        "properties": {
          "user_id": {
            "type": "string",
            "description": "Authenticated user ID from Better Auth",
            "pattern": "^auth0\\|[a-zA-Z0-9]{24}$",
            "example": "auth0|507f1f77bcf86cd799439011"
          },
          "task_id": {
            "type": "integer",
            "description": "ID of the task to mark as complete",
            "minimum": 1,
            "example": 3
          }
        },
        "required": ["user_id", "task_id"],
        "additionalProperties": false
      },
      "outputSchema": {
        "type": "object",
        "properties": {
          "task_id": {
            "type": "integer",
            "description": "ID of the completed task",
            "example": 3
          },
          "status": {
            "type": "string",
            "enum": ["completed"],
            "example": "completed"
          },
          "title": {
            "type": "string",
            "description": "Title of the completed task",
            "example": "Call mom"
          }
        },
        "required": ["task_id", "status", "title"]
      },
      "errors": [
        {
          "code": "NOT_FOUND",
          "message": "Task with specified ID not found for this user"
        },
        {
          "code": "ALREADY_COMPLETED",
          "message": "Task is already marked as complete"
        },
        {
          "code": "UNAUTHORIZED",
          "message": "user_id does not match task owner or authenticated user"
        },
        {
          "code": "DATABASE_ERROR",
          "message": "Failed to update task in database"
        }
      ]
    },
    {
      "name": "delete_task",
      "description": "Permanently delete a task for the authenticated user (hard delete, no soft delete)",
      "inputSchema": {
        "type": "object",
        "properties": {
          "user_id": {
            "type": "string",
            "description": "Authenticated user ID from Better Auth",
            "pattern": "^auth0\\|[a-zA-Z0-9]{24}$",
            "example": "auth0|507f1f77bcf86cd799439011"
          },
          "task_id": {
            "type": "integer",
            "description": "ID of the task to delete",
            "minimum": 1,
            "example": 5
          }
        },
        "required": ["user_id", "task_id"],
        "additionalProperties": false
      },
      "outputSchema": {
        "type": "object",
        "properties": {
          "task_id": {
            "type": "integer",
            "description": "ID of the deleted task",
            "example": 5
          },
          "status": {
            "type": "string",
            "enum": ["deleted"],
            "example": "deleted"
          },
          "title": {
            "type": "string",
            "description": "Title of the deleted task (for confirmation)",
            "example": "Old meeting"
          }
        },
        "required": ["task_id", "status", "title"]
      },
      "errors": [
        {
          "code": "NOT_FOUND",
          "message": "Task with specified ID not found for this user"
        },
        {
          "code": "UNAUTHORIZED",
          "message": "user_id does not match task owner or authenticated user"
        },
        {
          "code": "DATABASE_ERROR",
          "message": "Failed to delete task from database"
        }
      ]
    },
    {
      "name": "update_task",
      "description": "Update title and/or description of an existing task for the authenticated user",
      "inputSchema": {
        "type": "object",
        "properties": {
          "user_id": {
            "type": "string",
            "description": "Authenticated user ID from Better Auth",
            "pattern": "^auth0\\|[a-zA-Z0-9]{24}$",
            "example": "auth0|507f1f77bcf86cd799439011"
          },
          "task_id": {
            "type": "integer",
            "description": "ID of the task to update",
            "minimum": 1,
            "example": 1
          },
          "title": {
            "type": ["string", "null"],
            "description": "New title for the task (optional, max 500 chars)",
            "maxLength": 500,
            "example": "Buy groceries and fruits"
          },
          "description": {
            "type": ["string", "null"],
            "description": "New description for the task (optional, max 2000 chars)",
            "maxLength": 2000,
            "example": "Milk, eggs, bread, apples, and bananas"
          }
        },
        "required": ["user_id", "task_id"],
        "additionalProperties": false,
        "anyOf": [
          {"required": ["title"]},
          {"required": ["description"]}
        ]
      },
      "outputSchema": {
        "type": "object",
        "properties": {
          "task_id": {
            "type": "integer",
            "description": "ID of the updated task",
            "example": 1
          },
          "status": {
            "type": "string",
            "enum": ["updated"],
            "example": "updated"
          },
          "title": {
            "type": "string",
            "description": "Updated title of the task",
            "example": "Buy groceries and fruits"
          }
        },
        "required": ["task_id", "status", "title"]
      },
      "errors": [
        {
          "code": "NOT_FOUND",
          "message": "Task with specified ID not found for this user"
        },
        {
          "code": "VALIDATION_ERROR",
          "message": "Must provide at least one of 'title' or 'description' to update"
        },
        {
          "code": "VALIDATION_ERROR",
          "message": "Title cannot exceed 500 characters or description cannot exceed 2000 characters"
        },
        {
          "code": "UNAUTHORIZED",
          "message": "user_id does not match task owner or authenticated user"
        },
        {
          "code": "DATABASE_ERROR",
          "message": "Failed to update task in database"
        }
      ]
    }
  ],
  "generalPrinciples": {
    "stateless": "All MCP tools are stateless. They receive database session as parameter and do not maintain any in-memory state.",
    "userOwnership": "All tools validate that user_id matches the authenticated user's JWT token to prevent cross-user data access (Constitution Principle IV: Security First).",
    "errorHandling": "Tools raise structured exceptions with error codes and messages. Never expose stack traces to users.",
    "consistency": "All tools return consistent JSON structure with status field indicating operation result.",
    "auditTrail": "All database writes include user_id for audit purposes."
  }
}
