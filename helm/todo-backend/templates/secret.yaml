# =============================================================================
# Backend Secret - Kubernetes Manifest
# =============================================================================
# This template creates a Secret resource for sensitive environment variables
# NOTE: In production, use external secret management (Sealed Secrets, Vault, etc.)
# For Minikube: Create manually with kubectl create secret
# =============================================================================

apiVersion: v1
kind: Secret
metadata:
  name: {{ include "todo-backend.fullname" . }}-secrets
  labels:
    {{- include "todo-backend.labels" . | nindent 4 }}
type: Opaque
data:
  # These values should be base64-encoded
  # DO NOT commit actual secrets to Git
  #
  # Create this secret manually:
  # kubectl create secret generic todo-backend-secrets \
  #   --from-literal=openai-api-key=sk-proj-... \
  #   --from-literal=database-url=postgresql+asyncpg://... \
  #   --from-literal=better-auth-secret=your-32-char-secret \
  #   --from-literal=better-auth-issuer=http://localhost:8000 \
  #   --namespace=todo-app
  #
  # Or use --set-file during helm install:
  # helm install todo-backend ./helm/todo-backend \
  #   --set-file secrets.openai-api-key=<(echo -n $OPENAI_API_KEY | base64)

  {{- if .Values.secrets.OPENAI_API_KEY }}
  openai-api-key: {{ .Values.secrets.OPENAI_API_KEY | b64enc | quote }}
  {{- else }}
  # Placeholder - replace with actual value
  openai-api-key: ""
  {{- end }}

  {{- if .Values.secrets.DATABASE_URL }}
  database-url: {{ .Values.secrets.DATABASE_URL | b64enc | quote }}
  {{- else }}
  # Placeholder - replace with actual value
  database-url: ""
  {{- end }}

  {{- if .Values.secrets.BETTER_AUTH_SECRET }}
  better-auth-secret: {{ .Values.secrets.BETTER_AUTH_SECRET | b64enc | quote }}
  {{- else }}
  # Placeholder - replace with actual value
  better-auth-secret: ""
  {{- end }}

  {{- if .Values.secrets.BETTER_AUTH_ISSUER }}
  better-auth-issuer: {{ .Values.secrets.BETTER_AUTH_ISSUER | b64enc | quote }}
  {{- else }}
  better-auth-issuer: {{ "http://localhost:8000" | b64enc | quote }}
  {{- end }}
